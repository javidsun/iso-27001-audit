version: "3.9"

services:

  # ==========================================================
  # PostgreSQL Database
  # ==========================================================
  iso-audit-db:
    container_name: iso-audit-db
    image: postgres:16-alpine

    restart: unless-stopped

    environment:
      POSTGRES_USER: iso_user
      POSTGRES_DB: iso_audit
      POSTGRES_HOST_AUTH_METHOD: trust

    ports:
      - "5433:5432"   # Host 5433 -> Container 5432

    volumes:
      - iso_audit_pgdata:/var/lib/postgresql/data

  # ==========================================================
  # FastAPI Backend
  # ==========================================================
  iso-audit-backend:
    container_name: iso-audit-backend

    build:
      context: .
      dockerfile: Dockerfile

    depends_on:
      - iso-audit-db

    ports:
      - "8003:8003"

    environment:
      APP_ENV: dev

      # Database connection settings
      DB_HOST: iso-audit-db
      DB_PORT: 5432
      DB_NAME: iso_audit
      DB_USER: iso_user

    restart: unless-stopped

volumes:
  iso_audit_pgdata: